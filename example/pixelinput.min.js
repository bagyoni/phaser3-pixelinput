!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("phaser")):"function"==typeof define&&define.amd?define(["phaser"],e):"object"==typeof exports?exports.PixelInputPlugin=e(require("phaser")):t.PixelInputPlugin=e(t.Phaser)}(self,(t=>{return e={388:(t,e,s)=>{const i=s(977),r="pixelinput.clipboard",h={x:0,y:0,width:100,height:10,font:"please specify a font",font_size:16,border_color:0,bg_color:16777215,text_color:0,selection_color:8947848,selected_text_color:16777215,allowed_characters:i.GameObjects.RetroFont.TEXT_SET1,character_limit:256,history_limit:256};class o extends i.GameObjects.Container{constructor(t,e){super(t,e.x,e.y),this._config=e=Object.assign({},h,e),this._allowed_characters=[...e.allowed_characters],this._width=e.width,this._height=e.height,this._selection_pos=0,this._cursor_pos=0,this._cursor_height=this._height-4,this._history=[],this._history_index=-1,this._inner_mask=this._createMask(),this._box=this._createBox(),this._cursor=this._createCursor(),this._bmtext=this._createText(),t.input.keyboard.on("keydown",this._onKeyDown,this)}get text(){return this._bmtext.text}set text(t){this._insertText(t,0,1/0,!1),this._refresh()}get selectionStart(){return Math.min(this._selection_pos,this._cursor_pos)}get selectionEnd(){return Math.max(this._selection_pos,this._cursor_pos)}get clipboard(){return localStorage.getItem(r)}set clipboard(t){t.length>0&&(localStorage.setItem(r,t),navigator.clipboard.writeText(t))}clearHistory(){this._history=[],this._history_index=-1}destroy(t){this.scene.input.keyboard.off("keydown",this._onKeyDown,this),super.destroy(t),this._inner_mask.bitmapMask.destroy(t),this._inner_mask.destroy(t)}_createBox(){let t=this.scene.add.graphics({x:0,y:0}).fillStyle(this._config.border_color).fillRect(0,0,this._width,this._height).fillStyle(this._config.bg_color).fillRect(1,1,this._width-2,this._height-2).setScrollFactor(0);return this.add(t),t}_createCursor(){let t=this.scene.add.graphics({x:2,y:2}).fillStyle(this._config.selection_color).fillRect(0,0,1,this._cursor_height).setScrollFactor(0);return this.add(t),t.setMask(this._inner_mask),t}_createText(){let t=this.scene.add.bitmapText(2,2,this._config.font,"",this._config.font_size).setScrollFactor(0);return this.add(t),t.tintFill=this._config.text_color,t.setMask(this._inner_mask),t}_createMask(){let t=this.scene.add.graphics({x:this.x+2,y:this.y+2}).fillStyle(0).fillRect(0,0,this._width-4,this._height).setScrollFactor(0);return t.visible=!1,this.scene.add.bitmapMask(t)}_updateHistory(){this._history.splice(this._history_index+1),this._history.push(this._bmtext.text),this._history.length>this._config.history_limit&&this._history.splice(0,this._history.length-this._config.history_limit),this._history_index=this._history.length-1}_undo(){this._history_index=Math.max(-1,this._history_index-1);let t=this._history_index>-1?this._history[this._history_index]:"";this._insertText(t,0,1/0,!1)}_redo(){this._history_index=Math.min(this._history.length-1,this._history_index+1),this._insertText(this._history[this._history_index],0,1/0,!1)}_onKeyDown(t){this.visible&&(this._handleKeystrokes(t)||this._handleKeys(t),this._refresh())}_handleKeystrokes(t){if(!t.ctrlKey)return!1;let e=this._bmtext.text.slice(this.selectionStart,this.selectionEnd);switch(t.keyCode){case i.Input.Keyboard.KeyCodes.A:this._cursor_pos=this._bmtext.text.length,this._selection_pos=0;break;case i.Input.Keyboard.KeyCodes.C:this.clipboard=e;break;case i.Input.Keyboard.KeyCodes.V:this._insertText(this.clipboard,this.selectionStart,this.selectionEnd);break;case i.Input.Keyboard.KeyCodes.X:this.clipboard=e,this._insertText("",this.selectionStart,this.selectionEnd);break;case i.Input.Keyboard.KeyCodes.Y:this._redo();break;case i.Input.Keyboard.KeyCodes.Z:this._undo()}return!0}_handleKeys(t){switch(t.keyCode){case i.Input.Keyboard.KeyCodes.BACKSPACE:let e=this.selectionStart;e===this.selectionEnd&&e--,e=Math.max(0,e),this._insertText("",e,this.selectionEnd);break;case i.Input.Keyboard.KeyCodes.LEFT:this._cursor_pos=Math.max(0,this._cursor_pos-1),this._selection_pos=t.shiftKey?this._selection_pos:this._cursor_pos;break;case i.Input.Keyboard.KeyCodes.RIGHT:this._cursor_pos=Math.min(this._bmtext.text.length,this._cursor_pos+1),this._selection_pos=t.shiftKey?this._selection_pos:this._cursor_pos;break;default:if(1!==t.key.length)break;this._insertText(t.key,this.selectionStart,this.selectionEnd)}}_refresh(){this._updateTextPosition(),this._updateCursorPositions(),this._updateSelectionTint()}_insertText(t,e,s,i=!0){t=this._sanitizeText(t),e=Math.max(0,e);let r=this._bmtext.text.slice(0,e)+t+this._bmtext.text.slice(s);r.length>this._config.character_limit||(this._bmtext.text=r,this._cursor_pos=e+t.length,this._selection_pos=this._cursor_pos,i&&this._updateHistory())}_sanitizeText(t){return[...t].filter((t=>this._allowed_characters.includes(t))).join("")}_updateTextPosition(){let t=this._bmtext.getTextBounds().characters,e=this._getCursorX(t,this._cursor_pos),s=Math.max(0,2-e),i=Math.max(0,e-(this._width-2-1));this._bmtext.x+=s-i}_drawSingleLineSelection(t,e){let s=this._bmtext.getTextBounds().characters,i=this._getCursorX(s,t),r=(this._getCursorY(s,t),this._getCursorX(s,e));this._cursor.clear().fillStyle(this._config.selection_color).fillRect(i,0,Math.max(1,r-i+1),this._cursor_height)}_drawMultilineSelection(t,e){for(let s=t;s<e;s++)"\n"===this.text[s]&&(this._drawSingleLineSelection(t,s-1),t=s);this._drawSingleLineSelection(t,e)}_updateCursorPositions(){this._drawMultilineSelection(this.selectionStart,this.selectionEnd)}_updateSelectionTint(){this._bmtext.setCharacterTint(0,-1,!0,this._config.text_color).setCharacterTint(this.selectionStart,this.selectionEnd-this.selectionStart,!0,this._config.selected_text_color)}_getCursorX(t,e){return t.length>e?t[e].x+this._bmtext.x-1:t.length>0?t[t.length-1].r+this._bmtext.x:2}_getCursorY(t,e){return t.length>e?t[e].y+this._bmtext.y:t.length>0?t[t.length-1].b+this._bmtext.y:2}}t.exports=class t extends i.Plugins.BasePlugin{constructor(t){super(t)}static get DEFAULT_CFG(){return{key:"PixelInput",plugin:t,start:!0}}init(){this.pluginManager.registerGameObject("pixelInput",this._addPixelInput)}_addPixelInput(t){let e=new o(this.scene,t);return this.displayList.add(e),e}}},977:e=>{"use strict";e.exports=t}},s={},function t(i){var r=s[i];if(void 0!==r)return r.exports;var h=s[i]={exports:{}};return e[i](h,h.exports,t),h.exports}(388);var e,s}));